from knn import *
import glob

def online_variance(data,n=0,mean = 0,M2=0):

    for x in data:
        n = n + 1
        delta = x - mean
        mean = mean + delta/float(n)
        M2 = M2 + delta*(x - mean) 
        
    if n ==0:
        print "error"
        return 0,n,mean,M2
    
    variance_n = M2/float(n)
    variance = M2/float((n - 1))
    return variance,n,mean,M2

variances = [0]*128
varns= [0]*128
varmeans= [0]*128
varM2s= [0]*128
#[1149.626085391504, 1051.083840731649, 1113.106783263846, 1053.759441073503, 1277.6102378141552, 588.3951527104012, 545.233105907067, 653.4957829224396, 2728.1836883685687, 1691.6943450432734, 1086.0905494164092, 821.4790394511184, 1028.5283577146865, 624.7579782460942, 718.2485854600142, 1202.3875321446528, 2691.584160117102, 1211.0910473041022, 786.993669679376, 659.2063716002385, 970.6143319627546, 773.0069975010404, 1030.8867980759169, 1680.5046539356724, 1217.8155721174137, 754.6431641384502, 612.4456534493003, 599.9045028218598, 1141.793271515648, 958.1582829354181, 1056.431482950666, 1051.0695805068349, 1424.2922719597468, 963.687513834584, 1103.182724909064, 1273.084052020889, 1699.855387216655, 925.9863530315796, 661.2462922290081, 765.9889024139903, 2244.9667683831867, 1109.2379907990685, 1088.1488829095617, 1242.8120745170836, 1482.605419030014, 754.9892955814281, 615.0402673386068, 1431.2859025610546, 2375.3571916859605, 1321.225334888829, 592.4187838775742, 779.7406492473058, 1521.6146659758035, 1369.6559240646616, 1154.888628193895, 1180.2303338790966, 1440.9689868618632, 844.3903660026415, 685.1931415340554, 932.8499264481503, 1597.8258975422789, 1254.0163635407803, 1104.4738393981115, 1028.3177805475539, 1434.1273946071549, 750.8814269329347, 657.9387319945529, 925.0291194453649, 1693.403569387037, 1264.3257497914226, 1109.0173630836364, 971.2499111324989, 2244.996083320422, 1422.7569523817058, 616.1646052872165, 754.228081228605, 1480.1904180444271, 1242.4057134604886, 1086.4686863009172, 1110.7508997198022, 2376.827547923002, 1176.146950723775, 1149.0881896031938, 1366.8061900286982, 1524.8159640731767, 779.5391670386688, 591.5307543245451, 1329.3901653130608, 1436.3374870491737, 1023.921075396623, 1099.6777845652332, 1256.9944313926658, 1604.9290547584224, 935.9277704672446, 683.3142474559583, 837.7527690625473, 1155.843678504711, 647.7666547935048, 546.2761467447147, 585.1804388407182, 1269.226045070947, 1037.17142710629, 1118.0148783839436, 1049.256358652126, 2733.3095259013335, 1194.1378516714726, 719.0889301275821, 628.7246412043437, 1021.9022775250344, 817.755212432764, 1080.4575478498036, 1688.3866227951394, 2680.726624866373, 1671.661738065916, 1030.5958585263154, 775.3339745497486, 982.1965250785519, 656.0532649262839, 779.2961043002139, 1211.1106266560628, 1214.2352532762034, 1049.1997042163096, 1055.657666802987, 963.9719600972833, 1156.5745887887429, 591.756064929044, 610.4629073824141, 744.9209225747522]


for fname in glob.glob("pgm/*.key"):
    vec = loadimage(fname)
    for i in xrange(128):
        temp = [0]*len(vec)
        for j in xrange(len(vec)):temp[j]=vec[j][i]
        tup = online_variance(temp ,varns[i] ,varmeans[i] ,varM2s[i] )
        variances[i]=tup[0]
        varns[i]=tup[1]
        varmeans[i]=tup[2]
        varM2s[i]=tup[3]
    print fname
print variances

